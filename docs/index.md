# Config Validator Policy Library

Constraint templates specify the logic to be used by constraints.
This repository contains pre-defined constraint templates that you can implement or modify for your own needs. 

## Creating a constraint template
You can create and implement your own custom constraint templates.
For instructions on how to write constraint templates, see [How to write your own constraint templates](./constraint_template_authoring.md).

## Policy Bundles
In addition to browsing all [Available Templates](#available-templates) and [Sample Constraints](#sample-constraints),
you can explore these policy bundles:

- [CIS v1.0](./bundles/cis-v1.0.md)
- [CIS v1.1](./bundles/cis-v1.1.md)
- [GKE Hardening](./bundles/gke-hardening-v2019.11.11.md)
- [CFT Scorecard](./bundles/scorecard-v1.md)

## Available Templates

| Template                                                                                                                                     | Samples                                                                                                                    |
| -------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| [GCPAlwaysViolatesConstraintV1](../policies/templates/gcp_always_violates_v1.yaml)                                                           |                                                                                                                            |
| [GCPAppengineLocationConstraintV1](../policies/templates/gcp_appengine_location_v1.yaml)                                                     |                                                                                                                            |
| [GCPBigQueryDatasetLocationConstraintV1](../policies/templates/gcp_bq_dataset_location_v1.yaml)                                              |                                                                                                                            |
| [GCPCMEKRotationConstraintV1](../policies/templates/gcp_cmek_rotation_v1.yaml)                                                               | [cmek_rotation](../samples/cmek_rotation.yaml)                                                                             |
| [GCPComputeDiskResourcePoliciesConstraintV1](../policies/templates/gcp_compute_disk_resource_policies_v1.yaml)                               |                                                                                                                            |
| [GCPComputeIpForwardConstraintV1](../policies/templates/gcp_compute_ip_forward_v1.yaml)                                                      |                                                                                                                            |
| [GCPComputeZoneConstraintV1](../policies/templates/gcp_compute_zone_v1.yaml)                                                                 |                                                                                                                            |
| [GCPDNSSECPreventRSASHA1ConstraintV1](../policies/templates/gcp_dnssec_prevent_rsasha1_v1.yaml)                                              | [dnssec_prevent_rsasha1_zsk](../samples/dnssec_prevent_rsasha1_zsk.yaml)                                                   |
| [GCPEnforceLabelConstraintV1](../policies/templates/gcp_enforce_labels_v1.yaml)                                                              | [require_labels](../samples/enforce_label.yaml)                                                                            |
| [GCPExternalIpAccessConstraintV1](../policies/templates/legacy/gcp_external_ip_access_v1.yaml)                                               |                                                                                                                            |
| [GKEClusterLocationConstraintV1](../policies/templates/legacy/gcp_gke_cluster_location_v1.yaml)                                              | [gke_cluster_location](../samples/legacy/gke_cluster_location.yaml)                                                        |
| [GKEClusterVersionConstraintV1](../policies/templates/gcp_gke_cluster_version_v1.yaml)                                                       | [gke-cluster-version](../samples/gke_cluster_version.yaml)                                                                 |
| [GCPGKEDashboardConstraintV1](../policies/templates/gcp_gke_dashboard_v1.yaml)                                                               | [disable_gke_dashboard](../samples/gke_dashboard_disable.yaml)                                                             |
| [GCPGKEDisableLegacyEndpointsConstraintV1](../policies/templates/gcp_gke_disable_legacy_endpoints_v1.yaml)                                   | [disable_gke_legacy_endpoints](../samples/gke_disable_legacy_endpoints.yaml)                                               |
| [GCPGKEEnablePrivateEndpointConstraintV1](../policies/templates/gcp_gke_enable_private_endpoint.yaml)                                        | [gke_enable_private_endpoint](../samples/gke_enable_private_endpoint.yaml)                                                 |
| [GCPGKEEnableStackdriverKubernetesEngineMonitoringV1](../policies/templates/gcp_gke_enable_stackdriver_kubernetes_engine_monitoring_v1.yaml) | [enable_gke_stackdriver_kubernetes_engine_monitoring](../samples/gke_enable_stackdriver_kubernetes_engine_monitoring.yaml) |
| [GCPGKEEnableStackdriverMonitoringConstraintV1](../policies/templates/gcp_gke_enable_stackdriver_monitoring_v1.yaml)                         | [enable_gke_stackdriver_monitoring](../samples/gke_enable_stackdriver_monitoring.yaml)                                     |
| [GCPGKELegacyAbacConstraintV1](../policies/templates/gcp_gke_legacy_abac_v1.yaml)                                                            | [disable_gke_legacy_abac](../samples/gke_legacy_abac.yaml)                                                                 |
| [GCPGKENodeAutoRepairConstraintV1](../policies/templates/gcp_gke_node_auto_repair_v1.yaml)                                                   | [enable_auto_repair](../samples/gke_node_pool_auto_repair.yaml)                                                            |
| [GCPGKEPrivateClusterConstraintV1](../policies/templates/gcp_gke_private_cluster_v1.yaml)                                                    | [allow_only_private_cluster](../samples/gke_allow_only_private_cluster.yaml)                                               |
| [GCPGLBExternalIpAccessConstraintV1](../policies/templates/gcp_glb_external_ip_access_constraint_v1.yaml)                                    |                                                                                                                            |
| [GCPIAMAllowedPolicyMemberDomainsConstraintV1](../policies/templates/gcp_iam_allowed_policy_member_domains.yaml)                             | [service_accounts_only](../samples/iam_service_accounts_only.yaml)                                                         |
| [GCPIAMRequiredBindingsConstraintV1](../policies/templates/gcp_iam_required_bindings_v1.yaml)                                                | [require_members_and_domains_owner](../samples/iam_required_roles.yaml)                                                    |
| [GCPIAMRestrictServiceAccountKeyTypeConstraintV1](../policies/templates/gcp_iam_restrict_service_account_key_type_v1.yaml)                   | [iam_restrict_service_account_key_type](../samples/gcp_iam_restrict_service_account_key_type.yaml)                         |
| [GCPNetworkEnableFirewallLogsConstraintV1](../policies/templates/gcp_network_enable_firewall_logs_v1.yaml)                                   | [enable-network-firewall-logs](../samples/network_enable_firewall_logs.yaml)                                               |
| [GCPNetworkEnablePrivateGoogleAccessConstraintV1](../policies/templates/gcp_network_enable_private_google_access_v1.yaml)                    | [enable_network_private_google_access](../samples/network_enable_private_google_access.yaml)                               |
| [GCPGKERestrictPodTrafficConstraintV1](../policies/templates/gcp_gke_restrict_pod_traffic_v1.yaml)                                           | [gke_restrict_pod_traffic](../samples/gke_restrict_pod_traffic.yaml)                                                       |
| [GCPServiceUsageConstraintV1](../policies/templates/gcp_serviceusage_allowed_services_v1.yaml)                                               | [allow_basic_set_of_apis](../samples/serviceusage_allow_basic_apis.yaml)                                                   |
| [GCPSQLAllowedAuthorizedNetworksConstraintV1](../policies/templates/gcp_sql_allowed_authorized_networks_v1.yaml)                             | [sql_allowed_authorized_networks_whitelist](../samples/sql_allowed_authorized_networks.yaml)                               |
| [GCPSQLInstanceTypeConstraintV1](../policies/templates/gcp_sql_instance_type_v1.yaml)                                                        |                                                                                                                            |
| [GCPSQLMaintenanceWindowConstraintV1](../policies/templates/gcp_sql_maintenance_window_v1.yaml)                                              |                                                                                                                            |
| [GCPSQLSSLConstraintV1](../policies/templates/gcp_sql_ssl_v1.yaml)                                                                           |                                                                                                                            |
| [GCPStorageBucketRetentionConstraintV1](../policies/templates/gcp_storage_bucket_retention_v1.yaml)                                          | [storage_bucket_minimum_maximum_retention](../samples/storage_bucket_retention.yaml)                                       |
| [GCPStorageCMEKEncryptionConstraintV1](../policies/templates/gcp_storage_cmek_encryption_v1.yaml)                                            | [storage_cmek_encryption](../samples/storage_cmek_encryption.yaml)                                                         |
| [GCPStorageLoggingConstraintV1](../policies/templates/gcp_storage_logging_v1.yaml)                                                           | [storage_logging](../samples/storage_logging.yaml)                                                                         |
| [GCPVPCSCEnsureProjectConstraintV1](../policies/templates/gcp_vpc_sc_ensure_project_v1.yaml)                                                 | [vpc_sc_ensure_project](../samples/vpc_sc_ensure_project.yaml)                                                             |
| [GCPVPCSCIPRangeConstraintV1](../policies/templates/gcp_vpc_sc_ip_range_v1.yaml)                                                             | [vpc_sc_ip_range](../samples/vpc_sc_ip_range.yaml)                                                                         |
| [GCPVPCSCProjectPerimeterConstraintV2](../policies/templates/gcp_vpc_sc_project_perimeter_v2.yaml)                                           | [vpc_sc_project_perimeter_whitelist](../samples/vpc_sc_project_perimeter_whitelist.yaml)                                   |
| [GCPBigQueryTableRetentionConstraintV1](../policies/templates/gcp_bigquery_table_retention_v1.yaml)                                          |                                                                                                                            |

## Sample Constraints

The repo also contains a number of sample constraints:

| Sample                                                                                                                     | Template                                                                                      | Description                                                                         |
| -------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| [deny_some_resource_types](../samples/allowed_resource_types.yaml)                                                         |                                                                                               |                                                                                     |
| [service_versions](../samples/appengine_versions.yaml)                                                                     |                                                                                               |                                                                                     |
| [gcp-bq-cmek-encryption-v1](../samples/bigquery_cmek.yaml)                                                                 |                                                                                               |                                                                                     |
| [require_bq_table_iam](../samples/bigquery_world_readable.yaml)                                                            |                                                                                               |                                                                                     |
| [cmek_rotation](../samples/cmek_rotation.yaml)                                                                             | [Link](../policies/templates/gcp_cmek_rotation_v1.yaml)                                       |                                                                                     |
| [cmek_rotation](../samples/cmek_settings.yaml)                                                                             |                                                                                               |                                                                                     |
| [forbid_external_ip_whitelist](../samples/vm_external_ip.yaml)                                                             |                                                                                               |                                                                                     |
| [whitelist](../samples/compute_network_interface_whitelist.yaml)                                                           |                                                                                               |                                                                                     |
| [require_dnssec](../samples/dnssec.yaml)                                                                                   |                                                                                               |                                                                                     |
| [dnssec_prevent_rsasha1_zsk](../samples/dnssec_prevent_rsasha1_zsk.yaml)                                                   | [Link](../policies/templates/gcp_dnssec_prevent_rsasha1_v1.yaml)                              | Ensure that RSASHA1 is not used for zone-signing key in Cloud DNS                   |
| [require_labels](../samples/enforce_label.yaml)                                                                            | [Link](../policies/templates/gcp_enforce_labels_v1.yaml)                                      |                                                                                     |
| [gke_allowed_node_service_account_scope_default](../samples/gke_allowed_node_sa_scope.yaml)                                |                                                                                               |                                                                                     |
| [disable_gke_dashboard](../samples/gke_dashboard_disable.yaml)                                                             | [Link](../policies/templates/gcp_gke_dashboard_v1.yaml)                                       | Ensure Kubernetes web UI / Dashboard is disabled                                    |
| [disable_gke_legacy_endpoints](../samples/gke_disable_legacy_endpoints.yaml)                                               | [Link](../policies/templates/gcp_gke_disable_legacy_endpoints_v1.yaml)                        |                                                                                     |
| [gke_enable_private_endpoint](../samples/gke_enable_private_endpoint.yaml)                                                 | [Link](../policies/templates/gcp_gke_enable_private_endpoint.yaml)                            |                                                                                     |
| [enable_gke_stackdriver_kubernetes_engine_monitoring](../samples/gke_enable_stackdriver_kubernetes_engine_monitoring.yaml) | [Link](../policies/templates/gcp_gke_enable_stackdriver_kubernetes_engine_monitoring_v1.yaml) | Ensure Stackdriver Kubernetes Engine Monitoring is enabled                          |
| [enable_gke_stackdriver_monitoring](../samples/gke_enable_stackdriver_monitoring.yaml)                                     | [Link](../policies/templates/gcp_gke_enable_stackdriver_monitoring_v1.yaml)                   | Ensure stackdriver monitoring is enabled on a GKE cluster                           |
| [disable_gke_legacy_abac](../samples/gke_legacy_abac.yaml)                                                                 | [Link](../policies/templates/gcp_gke_legacy_abac_v1.yaml)                                     | Ensure Legacy Authorization is set to Disabled on Kubernetes Engine Clusters        |
| [enable_auto_repair](../samples/gke_node_pool_auto_repair.yaml)                                                            | [Link](../policies/templates/gcp_gke_node_auto_repair_v1.yaml)                                | Ensure automatic node repair is enabled on all node pools in a GKE cluster          |
| [allow_only_private_cluster](../samples/gke_allow_only_private_cluster.yaml)                                               | [Link](../policies/templates/gcp_gke_private_cluster_v1.yaml)                                 |                                                                                     |
| [gke_restrict_pod_traffic](../samples/gke_restrict_pod_traffic.yaml)                                                       | [Link](../policies/templates/gcp_gke_restrict_pod_traffic_v1.yaml)                            |                                                                                     |
| [iam_allow_roles](../samples/iam_allowed_roles.yaml)                                                                       |                                                                                               | Only the roles in this list are allowed. All other roles trigger violation.         |
| [blacklist-gmail-bigquery-dataset](../samples/iam_restrict_gmail_bigquery_dataset.yaml)                                    |                                                                                               | Enforce corporate domain by banning gmail.com addresses access to BigQuery datasets |
| [blacklist_all_users](../samples/iam_blacklist_public.yaml)                                                                |                                                                                               | Prevent public users from having access to resources via IAM                        |
| [blacklist_serviceaccount_token_creator](../samples/iam_blacklist_service_account_creator_role.yaml)                       |                                                                                               | Ban any users from being granted Service Account Token Creator access               |
| [whitelist_owner_role](../samples/iam_restrict_role.yaml)                                                                  |                                                                                               | Only my domain members are allowed to have the Owner role on projects               |
| [service_accounts_only](../samples/iam_service_accounts_only.yaml)                                                         | [Link](../policies/templates/gcp_iam_allowed_policy_member_domains.yaml)                      |                                                                                     |
| [require_members_and_domains_owner](../samples/iam_required_roles.yaml)                                                    | [Link](../policies/templates/gcp_iam_required_bindings_v1.yaml)                               | Trigger violations if the following members and domains are absent in roles/owner   |
| [iam_restrict_service_account_key_type](../samples/gcp_iam_restrict_service_account_key_type.yaml)                         | [Link](../policies/templates/gcp_iam_restrict_service_account_key_type_v1.yaml)               |                                                                                     |
| [enable-network-firewall-logs](../samples/network_enable_firewall_logs.yaml)                                               | [Link](../policies/templates/gcp_network_enable_firewall_logs_v1.yaml)                        | Ensure Firewall logs is enabled for every firewall in VPC Network                   |
| [enable_network_private_google_access](../samples/network_enable_private_google_access.yaml)                               | [Link](../policies/templates/gcp_network_enable_private_google_access_v1.yaml)                | Ensure Private Google Access is enabled for all subnetworks in VPC                  |
| [restrict-firewall-rule-allow-ingress-demo](../samples/restrict_fw_rules_generic.yaml)                                     |                                                                                               |                                                                                     |
| [restrict-firewall-rule-ssh-world-open](../samples/restrict_fw_rules_ssh_world_open.yaml)                                  |                                                                                               |                                                                                     |
| [sql_allowed_authorized_networks_whitelist](../samples/sql_allowed_authorized_networks.yaml)                               | [Link](../policies/templates/gcp_sql_allowed_authorized_networks_v1.yaml)                     |                                                                                     |
| [gcp-sql-backup-with-exemptions](../samples/sql_backup_with_exemptions.yaml)                                               |                                                                                               |                                                                                     |
| [allow_some_sql_location](../samples/sql_location.yaml)                                                                    |                                                                                               |                                                                                     |
| [prevent-public-ip-cloudsql](../samples/sql_public_ip.yaml)                                                                |                                                                                               | Prevents a public IP from being assigned to a Cloud SQL instance.                   |
| [allow_basic_set_of_apis](../samples/serviceusage_allow_basic_apis.yaml)                                                   | [Link](../policies/templates/gcp_serviceusage_allowed_services_v1.yaml)                       | Only a basic set of APIS                                                            |
| [allow_spanner_clusters_in_asia_and_europe](../samples/spanner_location.yaml)                                              |                                                                                               |                                                                                     |
| [storage_bucket_minimum_maximum_retention](../samples/storage_bucket_retention.yaml)                                       | [Link](../policies/templates/gcp_storage_bucket_retention_v1.yaml)                            |                                                                                     |
| [storage_cmek_encryption](../samples/storage_cmek_encryption.yaml)                                                         | [Link](../policies/templates/gcp_storage_cmek_encryption_v1.yaml)                             |                                                                                     |
| [storage_logging](../samples/storage_logging.yaml)                                                                         | [Link](../policies/templates/gcp_storage_logging_v1.yaml)                                     | Ensure storage logs are delivered to a separate bucket                              |
| [vpc_sc_ensure_project](../samples/vpc_sc_ensure_project.yaml)                                                             | [Link](../policies/templates/gcp_vpc_sc_ensure_project_v1.yaml)                               |                                                                                     |
| [vpc_sc_ip_range](../samples/vpc_sc_ip_range.yaml)                                                                         | [Link](../policies/templates/gcp_vpc_sc_ip_range_v1.yaml)                                     |                                                                                     |
| [vpc_sc_project_perimeter_whitelist](../samples/legacy/vpc_sc_project_perimeter_v1_whitelist.yaml)                         |                                                                                               |                                                                                     |
| [vpc_sc_project_perimeter_whitelist](../samples/vpc_sc_project_perimeter_whitelist.yaml)                                   | [Link](../policies/templates/gcp_vpc_sc_project_perimeter_v2.yaml)                            |                                                                                     |
| [gke_cluster_location](../samples/legacy/gke_cluster_location.yaml)                                                        | [Link](../policies/templates/legacy/gcp_gke_cluster_location_v1.yaml)                         |                                                                                     |
| [gke-cluster-version](../samples/gke_cluster_version.yaml)                                                                 | [Link](../policies/templates/gcp_gke_cluster_version_v1.yaml)                                 |                                                                                     |
